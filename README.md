# SelfStorage
Веб-приложение на Django для аренды складских помещений. 

## Как установить локально
Python3 должен быть установлен. 

1. Создайте виртуальное окружение и установите зависимости
   ```shell
   python -m venv venv && venv/bin/python install -r requirements.txt
   ```
2. Создайте в корневой директории папку `media` и добавьте в неё медиа-файлы (отправляются отдельно).

### Переменные окружения
- `DJANGO_SECRET_KEY` (обязательно) - секретный ключ django;
- `DEBUG` (опционально) - режим отладки (по умолчанию `False`);
- `ALLOWED_HOSTS` - разрешённые хосты;

Для отправки email-уведомлений:
- `EMAIL_HOST`, `EMAIL_PORT`, `EMAIL_HOST_USER`, `EMAIL_HOST_PASSWORD` -
получите эти настройки в вашем SMTP-сервисе.
- `EMAIL_SEND_FROM` - адрес отправителя (домен должен быть разрешен SMTP-сервисом)
- `NO_EMAIL` - не отправлять имейлы (во время разработки)

Для деплоя:
- `POSTGRES_USER`, `POSTGRES_PASSWORD`, `POSTGRES_DB` - переменные для postgres в контейнере
- `SERVER_NAME` - домен, без www
- `SERVER_IP` - ipv4

### Автодеплой
#### Для быстрого развертывания на сервере: 
1. Убедитесь, что установлен python3
2. Запустите `scripts/first_deploy.sh`

Этот скрипт: 
- установит зависимости 
- установит сервисы systemd:
  - postgres
  - основное приложение Django
  - отправка клиентам email-уведомлений об истекающей и истекшей аренде по таймеру
- запустит postgres в докер-контейнере
- загрузит тестовые объекты в базу данных
- создаст конфиг-файл для nginx
- запустит все сервисы

#### Быстро подтянуть новые версии и обновить приложение:
`scripts/deploy.sh`
